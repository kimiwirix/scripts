k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = 0)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = -1)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = 1)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = -0.3)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = 0.3)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = -0.2)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = -0.1)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = -0.8)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = 1)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = 0)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = 1)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = -11)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.8)%>%
hang.dendrogram(hang = -1)%>%
plot
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar=c(5,3,1,1))
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,4,4,2) + 0.1)
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
colors<-c("red", "blue", "green","orange", "purple", "yellow", "cyan", "darkgreen",
"magenta", "darkblue",  "pink", "darkred", "gray", "gold", "brown")#,"turquoise")
cut_tree<-cutree(cluster_mat,k=15, order_clusters_as_data = FALSE) #parses tree in k parts
table(cut_tree) #summary of how many organims in each cut part
cut_tree[cut_tree==1] #which organisms are in part 1
par(mar = c(9,4,4,2) + 0.1)
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,4,4,2) + 0.2) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,4,4,2) + 0.3) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,4,4,2) + 0.5) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,4,4,2) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(5,4,4,2) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,4,4,9) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,4,4,2) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,4,9,2) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,4,2,2) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,4,1,2) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(1,4,1,2) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,4,1,2) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,2,1,2) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,2,1,1) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
par(mar = c(9,2,1,0.5) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
plot(cluster_mat)
par(mar = c(9,2,1,0.5) + 0.6) #makes window bigger so labels can fit
plot(cluster_mat)
par(mar = c(9,2,1,0.5) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
png(file="C:/Users/natal/Documents/LIIGH/docs/docs_comsint_4c/parsed_dendogram.png",
width=32,height=18,units="cm",res=1200)
par(mar = c(9,2,1,0.5) + 0.6) #makes window bigger so labels can fit
cluster_mat%>%
as.dendrogram()%>%
color_branches(.,
k=15,
col=colors,
groupLabels = TRUE)%>%
set("labels_cex", 0.6)%>%
hang.dendrogram(hang = -1)%>%
plot
dev.off()
id_mat<-read.table("C:/Users/natal/Documents/LIIGH/data/data_comsint_4c/pyani_report/matrix_identity_1.tab" ,sep = "\t", header = TRUE)
id_mat <- id_mat %>%
column_to_rownames(var = "X")  # Set 'RowNames' as the row names
distance_mat<-1-id_mat
distance_mat<-as.dist(distance_mat)
cluster_mat<-hclust(distance_mat)
colors<-c("red", "blue", "green","orange", "purple", "yellow", "cyan", "darkgreen", "magenta", "darkblue",  "pink", "darkred", "gray", "gold", "brown")
cut_tree<-cutree(cluster_mat,k=15, order_clusters_as_data = FALSE) #parses tree in k parts
table(cut_tree) #summary of how many organims in each cut part
cut_tree[cut_tree==1] #which organisms are in part 1
library(tidyverse)
library(readODS)
library(stats)
library(FactoMineR)
library(factoextra)
library(ggfortify)
library(vegan)
library(ape)
library(ggnewscale)
#cambiar dependiendo el archivo
frequency_table<-read_ods("C:/Users/natal/Documents/LIIGH/feature-table-open-all-allbatches.ods", sheet = "matched")
frequency_table<-frequency_table %>%
column_to_rownames(var="#OTU ID") %>%
as.matrix()
colnames(frequency_table) <- ifelse(grepl("^N5", colnames(frequency_table)), sub("5", "S", colnames(frequency_table)), colnames(frequency_table)) #cambia el primer 5 a S de solo los que empiezan con N5
proportion_table<-apply(frequency_table, 2, function(x) x/sum(x))
proportion_table<-proportion_table %>%
t() %>%
as.data.frame()
proportion_table$label<-rownames(proportion_table) #pone como primera columna los rownames para mergear con las otras tablas
#METADATA
NS1<-read_ods("C:/Users/natal/Documents/LIIGH/data/data_comsint_rhizos/collection_sheet.ods", sheet="full")
NS1<-as.data.frame(NS1)
NS1<-NS1[c("community","hrs","temp","label","techrep","exp")]#solo deja el dataframe con esas columnas
NS2<-read_ods("C:/Users/natal/Documents/LIIGH/data/data_comsint_rhizos/collection_sheet_NS2.ods", sheet="full")
NS2<-as.data.frame(NS2)
NS2<-NS2[c("community","hrs","temp","label","techrep","exp")]
NS3<-read_ods("C:/Users/natal/Documents/LIIGH/data/data_comsint_rhizos/collection_sheet_NS3.ods", sheet="full")
NS3<-as.data.frame(NS3)
NS3<-NS3[c("community","hrs","temp","label","techrep","exp")]
NS4<-read_ods("C:/Users/natal/Documents/LIIGH/data/data_comsint_rhizos/collection_sheet_NS4.ods", sheet="full")
NS4<-as.data.frame(NS4)
NS4<-NS4[c("community","hrs","temp","label","techrep","exp")]
NS<-rbind(NS1,NS2,NS3,NS4)
#NS that we had to use techrep B since A failed
labels_B<- c("NS00037B", "NS00038B", "NS00039B", "NS00040B", "NS00041B", "NS00042B",
"NS00043B", "NS00044B", "NS00045B", "NS00046B", "NS00047B", "NS00048B",
"NS00079B", "NS00080B", "NS00081B", "NS00082B", "NS00083B", "NS00084B",
"NS00085B", "NS00086B", "NS00088B", "NS00089B", "NS00090B", "NS00165B",
"NS00169B", "NS00171B", "NS00173B")
labels_A <- gsub("B$", "A", labels_B)
metadata<-NS%>%
filter(techrep=="A" | (techrep=="B" & label %in% labels_B)) %>%
filter(!label %in% labels_A)%>%
filter(!label == "NS00087A") #lost sample:(
#merge
proportion_metadata<-merge(proportion_table, metadata, by = "label") #mergea metadata con proportion table por el label name
proportion_metadata[, 2:10] <- apply(proportion_metadata[,2:10], 2, as.numeric) #las columnas que tienen numeros de frequencias los convierte a numeric
proportion_metadata$group<-ifelse(proportion_metadata$exp %in% c("NS1", "NS3"), "Group1", "Group2") #agrupa NS1 y NS3 en Group1 y NS2 y NS4 en group 2
proportion_metadata
groups <- c("Group1", "Group2")
Freq <- proportion_metadata[proportion_metadata$group %in% groups, ][,2:10]
Meta <- proportion_metadata[proportion_metadata$group %in% groups, ][, -(2:10)]
Meta <- Meta %>%
mutate(hrs = as.numeric(hrs))
Freq.pca <- prcomp(Freq)
summary(Freq.pca)
Dat <- Freq.pca$x %>% as_tibble() %>%
bind_cols(Meta)
#PCA GRAPH
Dat %>%
ggplot(aes(x = PC1, y = PC2)) +
labs(title = "PCA", y = "PC2 (32.06%)", x = "PC1 (39.08%)")+
geom_point(data = Dat %>% filter(temp == "28"),
aes(fill = hrs), shape = 21, size = 4) +
scale_fill_gradient(low = "#74add1", high = "#e0f3f8", name = "28°C") +
new_scale_fill() +
geom_point(data = Dat %>% filter(temp == "32"),
aes(fill = hrs), shape = 21, size = 4) +
scale_fill_gradient(low = "#f46d43", high = "#ffffbf", name = "32°C") +
geom_point(data = Dat %>% filter(temp == "NA"),
fill = "black", shape = 21, size = 4) +
theme_classic()
proportion_metadata
#groups <- c("Group1", "Group2")
#groups <- c("Group1")
#groups <- c("Group2")
groups <- c("28")#, "32")
Freq <- proportion_metadata[proportion_metadata$temp %in% groups, ][,2:10]
Meta <- proportion_metadata[proportion_metadata$temp %in% groups, ][, -(2:10)]
Meta <- Meta %>%
mutate(hrs = as.numeric(hrs))
Freq.pca <- prcomp(Freq)
summary(Freq.pca)
Dat <- Freq.pca$x %>% as_tibble() %>%
bind_cols(Meta)
#PCA GRAPH
Dat %>%
ggplot(aes(x = PC1, y = PC2)) +
labs(title = "PCA", y = "PC2 (32.06%)", x = "PC1 (39.08%)")+
geom_point(data = Dat %>% filter(temp == "28"),
aes(fill = hrs), shape = 21, size = 4) +
scale_fill_gradient(low = "#74add1", high = "#e0f3f8", name = "28°C") +
new_scale_fill() +
geom_point(data = Dat %>% filter(temp == "32"),
aes(fill = hrs), shape = 21, size = 4) +
scale_fill_gradient(low = "#f46d43", high = "#ffffbf", name = "32°C") +
geom_point(data = Dat %>% filter(temp == "NA"),
fill = "black", shape = 21, size = 4) +
theme_classic()
#groups <- c("Group1", "Group2")
#groups <- c("Group1")
#groups <- c("Group2")
groups <- c("32")#, "32")
Freq <- proportion_metadata[proportion_metadata$temp %in% groups, ][,2:10]
Meta <- proportion_metadata[proportion_metadata$temp %in% groups, ][, -(2:10)]
Meta <- Meta %>%
mutate(hrs = as.numeric(hrs))
Freq.pca <- prcomp(Freq)
summary(Freq.pca)
Dat <- Freq.pca$x %>% as_tibble() %>%
bind_cols(Meta)
#PCA GRAPH
Dat %>%
ggplot(aes(x = PC1, y = PC2)) +
labs(title = "PCA", y = "PC2 (32.06%)", x = "PC1 (39.08%)")+
geom_point(data = Dat %>% filter(temp == "28"),
aes(fill = hrs), shape = 21, size = 4) +
scale_fill_gradient(low = "#74add1", high = "#e0f3f8", name = "28°C") +
new_scale_fill() +
geom_point(data = Dat %>% filter(temp == "32"),
aes(fill = hrs), shape = 21, size = 4) +
scale_fill_gradient(low = "#f46d43", high = "#ffffbf", name = "32°C") +
geom_point(data = Dat %>% filter(temp == "NA"),
fill = "black", shape = 21, size = 4) +
theme_classic()
#groups <- c("Group1", "Group2")
#groups <- c("Group1")
#groups <- c("Group2")
groups <- c("NA")#, "32")
Freq <- proportion_metadata[proportion_metadata$temp %in% groups, ][,2:10]
Meta <- proportion_metadata[proportion_metadata$temp %in% groups, ][, -(2:10)]
Meta <- Meta %>%
mutate(hrs = as.numeric(hrs))
Freq.pca <- prcomp(Freq)
summary(Freq.pca)
Dat <- Freq.pca$x %>% as_tibble() %>%
bind_cols(Meta)
#PCA GRAPH
Dat %>%
ggplot(aes(x = PC1, y = PC2)) +
labs(title = "PCA", y = "PC2 (32.06%)", x = "PC1 (39.08%)")+
geom_point(data = Dat %>% filter(temp == "28"),
aes(fill = hrs), shape = 21, size = 4) +
scale_fill_gradient(low = "#74add1", high = "#e0f3f8", name = "28°C") +
new_scale_fill() +
geom_point(data = Dat %>% filter(temp == "32"),
aes(fill = hrs), shape = 21, size = 4) +
scale_fill_gradient(low = "#f46d43", high = "#ffffbf", name = "32°C") +
geom_point(data = Dat %>% filter(temp == "NA"),
fill = "black", shape = 21, size = 4) +
theme_classic()
96/12
96/18
96/5
96/24
750*0.1333
750*0.133333333
.750*0.133333
750*0.13333/1000
0.300*0.1/30
1.5*10^7
1.5e+07*8
1.2e+08*13
(1.5e+7)*4*50
(1.5e+7)*8*100
3e+9*2
(3e+9)^2
